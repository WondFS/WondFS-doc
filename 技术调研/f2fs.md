# F2FS

## 【磁盘布局】
F2FS 文件系统全称为 Flash Friendly File System，是专为 NAND 闪存设计的日志结构文件系统。F2FS 文件系统将整个卷划分为六个区域，如下图所示，分别是超级块（Superblock），检查点（Checkpoint），段信息表（Segment Information Table），节点地址表（Node Address Table），段总结区域（Segment Summary Area），以及主区域（Main Area）。前 5 个区域总称为元数据区域，保存与 F2FS 文件系统直接相关的元数据信息，采用就地更新的方式，最后一个区域称为主区域，用于保存文件数据，采用异地更新的方式。
1)	超级块：保存了格式化文件系统时的基本信息，包括文件系统的大小，数据块大小，禁止或启用 Discard/Trim 命令 等只读信息。 
2)	检查点：主要作用是为了保证文件系统一致性，以及保证数据的可恢复性。F2FS文件系统维护两个版本的检查点信息：稳定版本保存的是系统稳定时的文件信息；当前版本保存的是系统运行时的文件信息。如果系统发生宕机，则回滚到稳定版本的检查点以保证文件系统一致性
3)	段信息表：主要包含了每个段的使用情况，比如无效块的数目。 
4)	节点地址表：通过记录节点块（Node Block）在主区域中的地址来解决滚雪球效
应。 
5)	段总结区：主要保存了主区域中所有块对应的文件索引节点以及偏移，并维护数据与逻辑块地址（LBA）的映射关系。 
6)	主区域：以 4KB 粒度进行块分配，块划分为数据块（Data Block）和节点块（Node Block），其中节点块用于存储文件的索引信息或是指向数据块的索引信息，而数据块主要存储目录文件或普通文件。
 
 
